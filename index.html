<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Expense Tracker</title>
  </head>

  <body>
    <header>
      <h1>Expense Tracker</h1>
    </header>
    <form onsubmit="savetoServer(event)">
      <label for="amount">Amount:</label>
      <input type="text" name="amount" id="amount" required />
      <label for="amount">Description:</label>
      <input type="text" id="descript" required />
      <label for="amount">Type:</label>
      <input type="text" id="type" required />
      <button id="submit">Submit</button>
    </form>
    <ul id="users"></ul>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
      // variables
      const amount = document.querySelector("#amount");
      const descript = document.querySelector("#descript");
      const type = document.querySelector("#type");
      const submitBtn = document.querySelector("#submit");
      const userList = document.querySelector("#users");

      // function
      function savetoServer(e) {
        e.preventDefault();
        const amount = e.target.amount.value;
        const descript = e.target.descript.value;
        const type = e.target.type.value;

        const obj = {
          amount,
          descript,
          type,
        };
        // saving to our server
        axios
          .post(
            "https://crudcrud.com/api/3c652292e55542dc95e1d54956ecb277/appointment",
            obj
          )
          .then((res) => display(res.data))
          .catch((err) => console.log(err));
        clearInputField();
      }
      const clearInputField = function () {
        amount.value = "";
        descript.value = "";
        type.value = "";
      };

      function display(obj) {
        console.log(obj, obj._id);
        const li = document.createElement("li");
        li.innerHTML = `<span>${obj.amount}</span>-<span>${obj.descript}</span>-<span>${obj.type}</span>`;
        li.className = "information";
        li.id = obj._id;

        // creating delete button element
        const deleteBtn = document.createElement("button");
        deleteBtn.className = "delete";
        deleteBtn.appendChild(document.createTextNode("Delete"));

        // appending the delete button to li
        li.appendChild(deleteBtn);

        // creating edit button element
        const editBtn = document.createElement("button");
        editBtn.className = "edit";
        editBtn.appendChild(document.createTextNode("Edit"));

        // appending the edit button to li
        li.appendChild(editBtn);

        // appending li to userlist
        userList.appendChild(li);
        clearInputField();
      }

      function displayFromServer() {
        // for (const val of Object.values(obj)) {
        //   console.log(val);
        // }
        axios
          .get(
            "https://crudcrud.com/api/3c652292e55542dc95e1d54956ecb277/appointment"
          )
          .then((res) => {
            const array = res.data;
            array.forEach((obj) => {
              console.log(obj, obj._id);
              const li = document.createElement("li");
              li.innerHTML = `<span>${obj.amount}</span>-<span>${obj.descript}</span>-<span>${obj.type}</span>`;
              li.className = "information";
              li.id = obj._id;

              // creating delete button element
              const deleteBtn = document.createElement("button");
              deleteBtn.className = "delete";
              deleteBtn.appendChild(document.createTextNode("Delete"));

              // appending the delete button to li
              li.appendChild(deleteBtn);

              // creating edit button element
              const editBtn = document.createElement("button");
              editBtn.className = "edit";
              editBtn.appendChild(document.createTextNode("Edit"));

              // appending the edit button to li
              li.appendChild(editBtn);

              // appending li to userlist
              userList.appendChild(li);
            });
          })
          .catch((err) => console.log(err));
      }

      function deleteUser(e) {
        if (e.target.classList.contains("delete")) {
          if (confirm("Are you sure you want to delete this item ?")) {
            const li = e.target.parentElement;
            li.style.display = "none";
            userList.removeChild(li);
            console.log(li, li.id);
            axios
              .delete(
                `https://crudcrud.com/api/3c652292e55542dc95e1d54956ecb277/appointment/${li.id}`
              )
              .then(() => alert("user deleted"))
              .catch((error) => console.log(error));
          }
        }
      }

      function editUser(e) {
        if (e.target.classList.contains("edit")) {
          if (confirm("Are you sure you want to edit this item ?")) {
            const litoEdit = e.target.parentElement;
            console.log(litoEdit);
            amount.value = litoEdit.children[0].textContent;
            descript.value = litoEdit.children[1].textContent;
            type.value = litoEdit.children[2].textContent;

            litoEdit.style.display = "none";
            userList.removeChild(litoEdit);
            console.log(litoEdit, litoEdit.id);
            axios
              .delete(
                `https://crudcrud.com/api/3c652292e55542dc95e1d54956ecb277/appointment/${litoEdit.id}`
              )
              .then(() => alert("enter user details"))
              .catch((error) => console.log(error));
          }
        }
      }

      // event listeners
      window.addEventListener("DOMContentLoaded", displayFromServer);
      userList.addEventListener("click", deleteUser);
      userList.addEventListener("click", editUser);
    </script>
  </body>
</html>
