<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Expense Tracker</title>
  </head>
  <body>
    <header><h1>Expense Tracker</h1></header>
    <form action="">
      <label for="amount">Amount:</label>
      <input type="text" name="amount" id="amount" required />
      <label for="amount">Description:</label>
      <input type="text" id="descript" required />
      <label for="amount">Type:</label>
      <input type="text" id="type" required />
      <button id="submit">Submit</button>
    </form>
    <ul id="users"></ul>
    <script>
      // variables
      const amount = document.querySelector("#amount");
      const descript = document.querySelector("#descript");
      const type = document.querySelector("#type");
      const submitBtn = document.querySelector("#submit");
      const userList = document.querySelector("#users");

      // function

      const editItem = function (e) {
        const descriptEdit = e.target.parentElement.firstChild.textContent
          .split(" ")[1]
          .slice(0, -1);
        const tempObj = JSON.parse(localStorage.getItem(descriptEdit));
        console.log(tempObj);
        if (e.target.classList.contains("edit")) {
          amount.value = tempObj.amount;
          descript.value = tempObj.descript;
          type.value = tempObj.type;

          const li = e.target.parentElement;
          li.style.display = "none";
          userList.removeChild(li);
          localStorage.removeItem(descriptEdit);
        }
      };

      const removeItem = function (e) {
        const descriptDel = e.target.parentElement.firstChild.textContent
          .split(" ")[1]
          .slice(0, -1);
        console.log(descriptDel);
        if (e.target.classList.contains("delete")) {
          if (confirm("Are you sure you want to delete this item")) {
            const li = e.target.parentElement; // this will refer to parent
            // of target here our target is X button and its parent is li element
            li.style.display = "none";
            userList.removeChild(li);
            console.log(descriptDel);
            localStorage.removeItem(descriptDel);
          }
        }
      };

      const displayExpense = function (descript) {
        const tempObj = JSON.parse(localStorage.getItem(descript));
        console.log(tempObj);

        // creatig list element
        const li = document.createElement("li");
        // Add text node with input values
        li.appendChild(document.createTextNode(`${tempObj.amount}`));
        li.appendChild(document.createTextNode(`: ${tempObj.descript}`));
        li.appendChild(document.createTextNode(`: ${tempObj.type}`));

        // Add HTML
        li.innerHTML = `${tempObj.amount}: ${tempObj.descript}: ${tempObj.type}`;

        // ading classname to li
        li.className = "information";

        // creating delete button element
        const deleteBtn = document.createElement("button");
        deleteBtn.className = "delete";
        deleteBtn.appendChild(document.createTextNode("Delete"));

        // appending the delete button to li
        li.appendChild(deleteBtn);

        // creating edit button element
        const editBtn = document.createElement("button");
        editBtn.className = "edit";
        editBtn.appendChild(document.createTextNode("Edit"));

        // appending the edit button to li
        li.appendChild(editBtn);

        // Append to ul
        userList.appendChild(li);
        clearInputField();
      };

      const addExpense = function (e) {
        e.preventDefault();
        const expenseObj = {
          amount: amount.value,
          descript: descript.value,
          type: type.value,
        };
        console.log(expenseObj);
        localStorage.setItem(expenseObj.descript, JSON.stringify(expenseObj));
        displayExpense(expenseObj.descript);
      };

      const clearInputField = function () {
        amount.value = "";
        descript.value = "";
        type.value = "";
      };

      //   clearInputField();

      // function to display localstorage items
      (function () {
        console.log("hello");
        for (const key of Object.keys(localStorage)) {
          displayExpense(key);
        }
      })();

      // event listeners
      submitBtn.addEventListener("click", addExpense);
      userList.addEventListener("click", removeItem);
      userList.addEventListener("click", editItem);
    </script>
  </body>
</html>
